// MonkeyPhysics: DatePicker
// this is a minified version, for production use
// source, updates and documentation available @ http://www.monkeyphysics.com/mootools
var DatePicker=new Class({Implements:Options,d:"",today:"",choice:{},bodysize:{},limit:{},attachTo:null,picker:null,slider:null,oldContents:null,newContents:null,input:null,visual:null,options:{pickerClass:"datepicker",days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],dayShort:2,monthShort:3,startDay:1,timePicker:!1,timePickerOnly:!1,yearPicker:!0,yearsPerPage:20,format:"d-m-Y",allowEmpty:!1,inputOutputFormat:"U",animationDuration:400,useFadeInOut:!Browser.Engine.trident,startView:"month",positionOffset:{x:0,y:0},minDate:null,maxDate:null,debug:!1,toggleElements:null,onShow:$empty,onClose:$empty,onSelect:$empty},initialize:function(a,b){this.attachTo=a,this.setOptions(b).attach(),this.options.timePickerOnly&&(this.options.timePicker=!0,this.options.startView="time"),this.formatMinMaxDates(),document.addEvent("mousedown",this.close.bind(this))},formatMinMaxDates:function(){this.options.minDate&&this.options.minDate.format&&(this.options.minDate=this.unformat(this.options.minDate.date,this.options.minDate.format)),this.options.maxDate&&this.options.maxDate.format&&(this.options.maxDate=this.unformat(this.options.maxDate.date,this.options.maxDate.format),this.options.maxDate.setHours(23),this.options.maxDate.setMinutes(59),this.options.maxDate.setSeconds(59))},attach:function(){if($chk(this.options.toggleElements)){var a=$$(this.options.toggleElements);document.addEvents({keydown:function(a){a.key=="tab"&&this.close(null,!0)}.bind(this)})}$$(this.attachTo).each(function(b,c){if(b.retrieve("datepicker"))return;if($chk(b.get("value")))var d=this.format(new Date(this.unformat(b.get("value"),this.options.inputOutputFormat)),this.options.format);else if(!this.options.allowEmpty)var d=this.format(new Date,this.options.format);else var d="";var e=b.getStyle("display"),f=b.setStyle("display",this.options.debug?e:"none").store("datepicker",!0).clone().store("datepicker",!0).removeProperty("name").setStyle("display",e).set("value",d).inject(b,"after");$chk(this.options.toggleElements)?(a[c].setStyle("cursor","pointer").addEvents({click:function(a){this.onFocus(b,f)}.bind(this)}),f.addEvents({blur:function(){b.set("value",f.get("value"))}})):f.addEvents({keydown:function(a){!this.options.allowEmpty||a.key!="delete"&&a.key!="backspace"?a.key=="tab"?this.close(null,!0):a.stop():(b.set("value",""),a.target.set("value",""),this.close(null,!0))}.bind(this),focus:function(a){this.onFocus(b,f)}.bind(this)})}.bind(this))},onFocus:function(a,b){var c,d=b.getCoordinates();$chk(a.get("value"))?c=this.unformat(a.get("value"),this.options.inputOutputFormat).valueOf():(c=new Date,$chk(this.options.maxDate)&&c.valueOf()>this.options.maxDate.valueOf()&&(c=new Date(this.options.maxDate.valueOf())),$chk(this.options.minDate)&&c.valueOf()<this.options.minDate.valueOf()&&(c=new Date(this.options.minDate.valueOf()))),this.show({left:d.left+this.options.positionOffset.x,top:d.top+d.height+this.options.positionOffset.y},c),this.input=a,this.visual=b,this.options.onShow()},dateToObject:function(a){return{year:a.getFullYear(),month:a.getMonth(),day:a.getDate(),hours:a.getHours(),minutes:a.getMinutes(),seconds:a.getSeconds()}},dateFromObject:function(a){var b=new Date;return b.setDate(1),["year","month","day","hours","minutes","seconds"].each(function(c){var e=a[c];if(!$chk(e))return;switch(c){case"day":b.setDate(e);break;case"month":b.setMonth(e);break;case"year":b.setFullYear(e);break;case"hours":b.setHours(e);break;case"minutes":b.setMinutes(e);break;case"seconds":b.setSeconds(e)}}),b},show:function(a,b){this.formatMinMaxDates(),$chk(b)?this.d=new Date(b):this.d=new Date,this.today=new Date,this.choice=this.dateToObject(this.d),this.mode=this.options.startView=="time"&&!this.options.timePicker?"month":this.options.startView,this.render(),this.picker.setStyles(a)},render:function(a){if(!$chk(this.picker))this.constructPicker();else{var b=this.oldContents;this.oldContents=this.newContents,this.newContents=b,this.newContents.empty()}var c=new Date(this.d.getTime());this.limit={right:!1,left:!1},this.mode=="decades"?this.renderDecades():this.mode=="year"?this.renderYear():this.mode=="time"?(this.renderTime(),this.limit={right:!0,left:!0}):this.renderMonth(),this.picker.getElement(".previous").setStyle("visibility",this.limit.left?"hidden":"visible"),this.picker.getElement(".next").setStyle("visibility",this.limit.right?"hidden":"visible"),this.picker.getElement(".titleText").setStyle("cursor",this.allowZoomOut()?"pointer":"default"),this.d=c,this.picker.getStyle("opacity")==0&&this.picker.tween("opacity",0,1),$chk(a)&&this.fx(a)},fx:function(a){a=="right"?(this.oldContents.setStyles({left:0,opacity:1}),this.newContents.setStyles({left:this.bodysize.x,opacity:1}),this.slider.setStyle("left",0).tween("left",0,-this.bodysize.x)):a=="left"?(this.oldContents.setStyles({left:this.bodysize.x,opacity:1}),this.newContents.setStyles({left:0,opacity:1}),this.slider.setStyle("left",-this.bodysize.x).tween("left",-this.bodysize.x,0)):a=="fade"&&(this.slider.setStyle("left",0),this.oldContents.setStyle("left",0).set("tween",{duration:this.options.animationDuration/2}).tween("opacity",1,0),this.newContents.setStyles({opacity:0,left:0}).set("tween",{duration:this.options.animationDuration}).tween("opacity",0,1))},constructPicker:function(){this.picker=(new Element("div",{"class":this.options.pickerClass})).inject(document.body),this.options.useFadeInOut&&this.picker.setStyle("opacity",0).set("tween",{duration:this.options.animationDuration});var a=(new Element("div",{"class":"header"})).inject(this.picker),b=(new Element("div",{"class":"title"})).inject(a);(new Element("div",{"class":"previous"})).addEvent("click",this.previous.bind(this)).set("text","«").inject(a),(new Element("div",{"class":"next"})).addEvent("click",this.next.bind(this)).set("text","»").inject(a),(new Element("div",{"class":"closeButton"})).addEvent("click",this.close.bindWithEvent(this,!0)).set("text","x").inject(a),(new Element("span",{"class":"titleText"})).addEvent("click",this.zoomOut.bind(this)).inject(b);var c=(new Element("div",{"class":"body"})).inject(this.picker);this.bodysize=c.getSize(),this.slider=(new Element("div",{styles:{position:"absolute",top:0,left:0,width:2*this.bodysize.x,height:this.bodysize.y}})).set("tween",{duration:this.options.animationDuration,transition:Fx.Transitions.Quad.easeInOut}).inject(c),this.oldContents=(new Element("div",{styles:{position:"absolute",top:0,left:this.bodysize.x,width:this.bodysize.x,height:this.bodysize.y}})).inject(this.slider),this.newContents=(new Element("div",{styles:{position:"absolute",top:0,left:0,width:this.bodysize.x,height:this.bodysize.y}})).inject(this.slider)},renderTime:function(){var a=(new Element("div",{"class":"time"})).inject(this.newContents);this.options.timePickerOnly?this.picker.getElement(".titleText").set("text","Select a time"):this.picker.getElement(".titleText").set("text",this.format(this.d,"j M, Y")),(new Element("input",{type:"text","class":"hour"})).set("value",this.leadZero(this.d.getHours())).addEvents({mousewheel:function(a){var b=a.target,c=b.get("value").toInt();b.focus(),a.wheel>0?c=c<23?c+1:0:c=c>0?c-1:23,b.set("value",this.leadZero(c)),a.stop()}.bind(this)}).set("maxlength",2).inject(a),(new Element("input",{type:"text","class":"minutes"})).set("value",this.leadZero(this.d.getMinutes())).addEvents({mousewheel:function(a){var b=a.target,c=b.get("value").toInt();b.focus(),a.wheel>0?c=c<59?c+1:0:c=c>0?c-1:59,b.set("value",this.leadZero(c)),a.stop()}.bind(this)}).set("maxlength",2).inject(a),(new Element("div",{"class":"separator"})).set("text",":").inject(a),(new Element("input",{type:"submit",value:"OK","class":"ok"})).addEvents({click:function(a){a.stop(),this.select($merge(this.dateToObject(this.d),{hours:this.picker.getElement(".hour").get("value").toInt(),minutes:this.picker.getElement(".minutes").get("value").toInt()}))}.bind(this)}).set("maxlength",2).inject(a)},renderMonth:function(){var a=this.d.getMonth();this.picker.getElement(".titleText").set("text",this.options.months[a]+" "+this.d.getFullYear()),this.d.setDate(1);while(this.d.getDay()!=this.options.startDay)this.d.setDate(this.d.getDate()-1);var b=(new Element("div",{"class":"days"})).inject(this.newContents),c=(new Element("div",{"class":"titles"})).inject(b),d,e,f,g,h;for(d=this.options.startDay;d<this.options.startDay+7;d++)(new Element("div",{"class":"title day day"+d%7})).set("text",this.options.days[d%7].substring(0,this.options.dayShort)).inject(c);var i=!1,j=this.today.toDateString(),k=this.dateFromObject(this.choice).toDateString();for(e=0;e<42;e++)f=[],f.push("day"),f.push("day"+this.d.getDay()),this.d.toDateString()==j&&f.push("today"),this.d.toDateString()==k&&f.push("selected"),this.d.getMonth()!=a&&f.push("otherMonth"),e%7==0&&(h=(new Element("div",{"class":"week week"+Math.floor(e/7)})).inject(b)),g=(new Element("div",{"class":f.join(" ")})).set("text",this.d.getDate()).inject(h),this.limited("date")?(g.addClass("unavailable"),i?this.limit.right=!0:this.d.getMonth()==a&&(this.limit.left=!0)):(i=!0,g.addEvent("click",function(a,b){this.options.timePicker?(this.d.setDate(b.day),this.d.setMonth(b.month),this.mode="time",this.render("fade")):this.select(b)}.bindWithEvent(this,{day:this.d.getDate(),month:this.d.getMonth(),year:this.d.getFullYear()}))),this.d.setDate(this.d.getDate()+1);i||(this.limit.right=!0)},renderYear:function(){var a=this.today.getMonth(),b=this.d.getFullYear()==this.today.getFullYear(),c=this.d.getFullYear()==this.choice.year;this.picker.getElement(".titleText").set("text",this.d.getFullYear()),this.d.setMonth(0);var d,e,f=!1,g=(new Element("div",{"class":"months"})).inject(this.newContents);for(d=0;d<=11;d++)e=(new Element("div",{"class":"month month"+(d+1)+(d==a&&b?" today":"")+(d==this.choice.month&&c?" selected":"")})).set("text",this.options.monthShort?this.options.months[d].substring(0,this.options.monthShort):this.options.months[d]).inject(g),this.limited("month")?(e.addClass("unavailable"),f?this.limit.right=!0:this.limit.left=!0):(f=!0,e.addEvent("click",function(a,b){this.d.setDate(1),this.d.setMonth(b),this.mode="month",this.render("fade")}.bindWithEvent(this,d))),this.d.setMonth(d);f||(this.limit.right=!0)},renderDecades:function(){while(this.d.getFullYear()%this.options.yearsPerPage>0)this.d.setFullYear(this.d.getFullYear()-1);this.picker.getElement(".titleText").set("text",this.d.getFullYear()+"-"+(this.d.getFullYear()+this.options.yearsPerPage-1));var a,b,c,d=!1,e=(new Element("div",{"class":"years"})).inject(this.newContents);$chk(this.options.minDate)&&this.d.getFullYear()<=this.options.minDate.getFullYear()&&(this.limit.left=!0);for(a=0;a<this.options.yearsPerPage;a++)b=this.d.getFullYear(),c=(new Element("div",{"class":"year year"+a+(b==this.today.getFullYear()?" today":"")+(b==this.choice.year?" selected":"")})).set("text",b).inject(e),this.limited("year")?(c.addClass("unavailable"),d?this.limit.right=!0:this.limit.left=!0):(d=!0,c.addEvent("click",function(a,b){this.d.setFullYear(b),this.mode="year",this.render("fade")}.bindWithEvent(this,b))),this.d.setFullYear(this.d.getFullYear()+1);d||(this.limit.right=!0),$chk(this.options.maxDate)&&this.d.getFullYear()>=this.options.maxDate.getFullYear()&&(this.limit.right=!0)},limited:function(a){var b=$chk(this.options.minDate),c=$chk(this.options.maxDate);if(!b&&!c)return!1;switch(a){case"year":return b&&this.d.getFullYear()<this.options.minDate.getFullYear()||c&&this.d.getFullYear()>this.options.maxDate.getFullYear();case"month":var d=(""+this.d.getFullYear()+this.leadZero(this.d.getMonth())).toInt();return b&&d<(""+this.options.minDate.getFullYear()+this.leadZero(this.options.minDate.getMonth())).toInt()||c&&d>(""+this.options.maxDate.getFullYear()+this.leadZero(this.options.maxDate.getMonth())).toInt();case"date":return b&&this.d<this.options.minDate||c&&this.d>this.options.maxDate}},allowZoomOut:function(){return this.mode=="time"&&this.options.timePickerOnly?!1:this.mode=="decades"?!1:this.mode=="year"&&!this.options.yearPicker?!1:!0},zoomOut:function(){if(!this.allowZoomOut())return;this.mode=="year"?this.mode="decades":this.mode=="time"?this.mode="month":this.mode="year",this.render("fade")},previous:function(){this.mode=="decades"?this.d.setFullYear(this.d.getFullYear()-this.options.yearsPerPage):this.mode=="year"?this.d.setFullYear(this.d.getFullYear()-1):this.mode=="month"&&(this.d.setDate(1),this.d.setMonth(this.d.getMonth()-1)),this.render("left")},next:function(){this.mode=="decades"?this.d.setFullYear(this.d.getFullYear()+this.options.yearsPerPage):this.mode=="year"?this.d.setFullYear(this.d.getFullYear()+1):this.mode=="month"&&(this.d.setDate(1),this.d.setMonth(this.d.getMonth()+1)),this.render("right")},close:function(a,b){if(!$(this.picker))return;var c=$chk(a)&&a.target!=this.picker&&!this.picker.hasChild(a.target)&&a.target!=this.visual;if(b||c)this.options.useFadeInOut?this.picker.set("tween",{duration:this.options.animationDuration/2,onComplete:this.destroy.bind(this)}).tween("opacity",1,0):this.destroy()},destroy:function(){this.picker.destroy(),this.picker=null,this.options.onClose()},select:function(a){this.choice=$merge(this.choice,a);var b=this.dateFromObject(this.choice);this.input.set("value",this.format(b,this.options.inputOutputFormat)),this.visual.set("value",this.format(b,this.options.format)),this.options.onSelect(b),this.close(null,!0)},leadZero:function(a){return a<10?"0"+a:a},format:function(a,b){var c="",d=a.getHours(),e=a.getMonth();for(var f=0;f<b.length;f++)switch(b.charAt(f)){case"\\":f++,c+=b.charAt(f);break;case"y":c+=(a.getFullYear()+"").substring(2);break;case"Y":c+=a.getFullYear();break;case"m":c+=this.leadZero(e+1);break;case"n":c+=e+1;break;case"M":c+=this.options.months[e].substring(0,this.options.monthShort);break;case"F":c+=this.options.months[e];break;case"d":c+=this.leadZero(a.getDate());break;case"j":c+=a.getDate();break;case"D":c+=this.options.days[a.getDay()].substring(0,this.options.dayShort);break;case"l":c+=this.options.days[a.getDay()];break;case"G":c+=d;break;case"H":c+=this.leadZero(d);break;case"g":c+=d%12?d%12:12;break;case"h":c+=this.leadZero(d%12?d%12:12);break;case"a":c+=d>11?"pm":"am";break;case"A":c+=d>11?"PM":"AM";break;case"i":c+=this.leadZero(a.getMinutes());break;case"s":c+=this.leadZero(a.getSeconds());break;case"U":c+=Math.floor(a.valueOf()/1e3);break;default:c+=b.charAt(f)}return c},unformat:function(a,b){var c=new Date;c.setMonth(0),c.setDate(1);var d={},e,f;a=a.toString();for(var g=0;g<b.length;g++){e=b.charAt(g);switch(e){case"\\":r=null,g++;break;case"y":r="[0-9]{2}";break;case"Y":r="[0-9]{4}";break;case"m":r="0[1-9]|1[012]";break;case"n":r="[1-9]|1[012]";break;case"M":r="[A-Za-z]{"+this.options.monthShort+"}";break;case"F":r="[A-Za-z]+";break;case"d":r="0[1-9]|[12][0-9]|3[01]";break;case"j":r="[12][0-9]|3[01]|[1-9]";break;case"D":r="[A-Za-z]{"+this.options.dayShort+"}";break;case"l":r="[A-Za-z]+";break;case"G":case"H":case"g":case"h":r="[0-9]{1,2}";break;case"a":r="(am|pm)";break;case"A":r="(AM|PM)";break;case"i":case"s":r="[012345][0-9]";break;case"U":r="-?[0-9]+$";break;default:r=null}if($chk(r)){f=a.match("^"+r);if(!$chk(f))return this.options.debug&&alert("Fatal Error in DatePicker\n\nUnexpected format at: '"+a+"' expected format character '"+e+"' (pattern '"+r+"')"),c;d[e]=f[0],a=a.substring(d[e].length)}else a=a.substring(1)}for(e in d){var h=d[e];switch(e){case"y":c.setFullYear(h<30?2e3+h.toInt():1900+h.toInt());break;case"Y":c.setFullYear(h);break;case"m":case"n":c.setMonth(h-1);break;case"M":h=this.options.months.filter(function(a,b){return a.substring(0,this.options.monthShort)==h}.bind(this))[0];case"F":c.setMonth(this.options.months.indexOf(h));break;case"d":case"j":c.setDate(h);break;case"G":case"H":c.setHours(h);break;case"g":case"h":d["a"]=="pm"||d["A"]=="PM"?c.setHours(h==12?0:h.toInt()+12):c.setHours(h);break;case"i":c.setMinutes(h);break;case"s":c.setSeconds(h);break;case"U":c=new Date(h.toInt()*1e3)}}return c}});