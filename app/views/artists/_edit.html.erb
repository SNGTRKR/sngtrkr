<%= image_tag "/images/f-bulge-left.png", :alt => "Shadow", :id => "bulge-left" %>
<%= image_tag "/images/f-bulge-right.png", :alt => "Shadow", :id => "bulge-right" %>
<h2 class="signika-txt top-header font-35 add-release-header">Manage an artist</h2>	
<% artist = edit %>
<div id="steps">
<%= form_for artist do |f| %>
<fieldset class="step">
	<div class="step-back manage-details-step">
		<div class="step-left left">
			<ul>
				<li>
					<strong><%= f.label "Artist Name*" %></strong>
					<%= f.text_field :name, :class => 'form-text' %>
				</li>
				<li>
					<strong><%= f.label "Genre*" %></strong>
					<%= f.text_field :genre, :class => 'form-text' %>
				</li>
				<li>
					<strong><%= f.label "Label*" %></strong>
					<%= f.text_field :label_name, :class => 'form-text' %>
				</li>
				<li>
					<strong><%= f.label "Bio" %></strong>
					<%= f.text_area :bio, :rows => 8, :cols => 40, :class => 'form-text' %>
				</li>
				<li>
					<strong><%= f.label "Website" %></strong>
					<%= f.text_field :website, :class => 'form-text' %>
				</li>
				<li>
					<strong><%= f.label "Twitter" %></strong>
					<%= f.text_field :website, :class => 'form-text' %>
				</li>
				<li>
					<strong><%= f.label "Soundcloud" %></strong>
					<%= f.text_field :soundcloud, :class => 'form-text' %>
				</li>
				<li>
					<strong><%= f.label "Youtube" %></strong>
					<%= f.text_field :youtube, :class => 'form-text' %>
				</li>
			</ul>
		</div>
		<div class="step-right right">
			Here is the information we have managed to gather from your Facebook fan page. Please check this information, by completing any missing or incorrect fields.
			<br/>
			<br/>
			We recommend a maximum of 330 characters for the biography, making it short but sweet.
			<br/>
			<br/>
			Furthermore, please only enter your username for the Twitter, Soundcloud and Youtube fields.
			<br/>
			<br/>
			Please be aware, all of this information will be available to the public.
			<br/>
			<br/>
			<strong>* Required fields.</strong>
		</div>
		<div id="details-line"></div>
	</div>
</fieldset>
<fieldset class="step">
	<div class="step-back manage-picture-step">
		<div class="step-left left">
			<strong><%= f.label :picture %></strong>
			<strong><%= f.file_field 'image' %></strong></br/><br/>
			<strong>Preview:</strong><br/>
			<div class="manage-image"><img class="bleed" src="/assets/images/bleed.png"/><%= image_tag (artist.image :manage) %></div>
		</div>
		<div class="step-right right">
			Please upload a picture which would best represent you as an artist.
			<br/>
			</br/>
			The artwork needs to be at least 365px width and 300px with. The file size can be no bigger than 1MB.
			<br/>
			</br/>
			<div class="default-button">
				<div class="o-button norm-o-pad right signika-font font-13">
					Restore to default<span></span>
				</div>
			</div>
		</div>
		<div id="picture-line"></div>
	</div>
</fieldset>

<fieldset class="step">
	<div class="step-back manage-summary-step">
		<div class="step-left left">
						<ul>
							<li>
								<strong>Artist Name:</strong>
							</li>
							<li>
								<strong>Genre:</strong>
							</li>
							<li>
								<strong>Label:</strong>
							</li>
							<li>
								<strong>Bio:</strong>
							</li>
							<br/>
							</br/>
							<li>
								<strong>Website:</strong>
							</li>
							<li>
								<strong>Twitter:</strong>
							</li>
							<li>
								<strong>Soundcloud:</strong>
							</li>
							<li>
								<strong>Youtube:</strong>
							</li>
						</ul>
					</div>
					<div class="step-right right">
						Here is a summary of all the information you have entered for your artist profile. Please read over and check everything.
						<br/>
						<br/>
						If you wish to change anything, please use the menu below to return to previous stages. Once you are happy with your artist profile settings,  click the submit button below.
						<br/>
						<br/>
						<strong>If you would like information on how to get started with using your artist timeline, and adding new releases, then head on over to our help page.</strong>
						<div id="submit-pad">
							<div class="o-button right norm-o-pad signika-font">
										<%= f.submit "Submit", :class => 'submit-button' %>
								<span></span>
							</div>
						</div>
					</div>
					<div id="summary-line"></div>
	</div>
</fieldset>
<% end %>
</div>
<div id="navigation" style="display:none;">
			<ul>
				<li class="selected signika-font o-button norm-o-pad">
					<a href="#" class="manage-details"><h3>1. Details</h3></a>
				</li>
				<li class="signika-font o-button norm-o-pad">
					<a href="#" class="manage-picture"><h3>2. Picture</h3></a>
				</li>
				<li class="signika-font o-button norm-o-pad">
					<a href="#" class="manage-summary"><h3>3. Summary</h3></a>
				</li>
			</ul>
		</div>
		<div id="progress-bar">
			<div class="progress o-button">
				<div class="percent instruct-font">
					50%
				</div>
			</div>
		</div>
<script type="text/javascript">
	$(document).ready(function() {
		$(".manage-details").click(function() {
			$(".step-back").animate({
				height : 421
			}, "slow");
			$(".step").animate({
				height : 510
			}, "slow");
			$(".progress").animate({
				width : 130
			}, "slow");
			$('#bulge-left').animate({
					height : 607
				}, "slow");
				$('#bulge-left').animate({
					width : 48
				}, 10);
				$('#bulge-right').animate({
					height : 607
				}, "slow");
				$('#bulge-right').animate({
					width : 48
				}, 10);
			$('.percent').html('50%');
			$('.white-tint').hide();
			$('.white-tint-2').show();
			$('.white-tint-3').show();
		});
		$(".manage-picture").click(function() {
			$(".step-back").animate({
				height : 187
			}, "slow");
			$(".step").animate({
				height : 275
			}, "slow");
			$(".progress").animate({
				width : 195
			}, "slow");
			$('#bulge-left').animate({
					height : 371
				}, "slow");
				$('#bulge-left').animate({
					width : 48
				}, 10);
				$('#bulge-right').animate({
					height : 371
				}, "slow");
				$('#bulge-right').animate({
					width : 48
				}, 10);
			$('.percent').html('75%');
			$('.white-tint-2').hide();
			$('.white-tint-3').show();
			$('.white-tint').show();
		});
		$(".manage-summary").click(function() {
			$(".step-back").animate({
				height : 283
			}, "slow");
			$(".step").animate({
				height : 371
			}, "slow");
			$(".progress").animate({
				width : 265
			}, "slow");
			$('#bulge-left').animate({
					height : 467
				}, "slow");
				$('#bulge-left').animate({
					width : 48
				}, 10);
				$('#bulge-right').animate({
					height : 467
				}, "slow");
				$('#bulge-right').animate({
					width : 48
				}, 10);
			$('.percent').html('100%');
			$('.white-tint-3').hide();
			$('.white-tint-2').show();
			$('.white-tint').show();
		});
	}); 
	$(function() {
	/*
	number of fieldsets
	*/
	var fieldsetCount = $('.edit_artist').children().length;
	
	/*
	current position of fieldset / navigation link
	*/
	var current 	= 1;
    
	/*
	sum and save the widths of each one of the fieldsets
	set the final sum as the total width of the steps element
	*/
	var stepsWidth	= 0;
    var widths 		= new Array();
	$('#steps .step').each(function(i){
        var $step 		= $(this);
		widths[i]  		= stepsWidth;
        stepsWidth	 	+= $step.width();
    });
	$('#steps').width(stepsWidth);
	
	/*
	to avoid problems in IE, focus the first input of the form
	*/
	$('.edit_artist').children(':first').find(':input:first').focus();	
	
	/*
	show the navigation bar
	*/
	$('#navigation').show();
	
	/*
	when clicking on a navigation link 
	the form slides to the corresponding fieldset
	*/
    $('#navigation a').bind('click',function(e){
		var $this	= $(this);
		var prev	= current;
		$this.closest('ul').find('li').removeClass('selected');
        $this.parent().addClass('selected');
		/*
		we store the position of the link
		in the current variable	
		*/
		current = $this.parent().index() + 1;
		/*
		animate / slide to the next or to the corresponding
		fieldset. The order of the links in the navigation
		is the order of the fieldsets.
		Also, after sliding, we trigger the focus on the first 
		input element of the new fieldset
		If we clicked on the last link (confirmation), then we validate
		all the fieldsets, otherwise we validate the previous one
		before the form slided
		*/
        $('#steps').stop().animate({
            marginLeft: '-' + widths[current-1] + 'px'
        },500,function(){
			if(current == fieldsetCount)
				validateSteps();
			else
				validateStep(prev);
			$('.edit_artist').children(':nth-child('+ parseInt(current) +')').find(':input:first').focus();	
		});
        e.preventDefault();
    });
	
	/*
	clicking on the tab (on the last input of each fieldset), makes the form
	slide to the next step
	*/
	$('.edit_artist > fieldset').each(function(){
		var $fieldset = $(this);
		$fieldset.children(':last').find(':li').keydown(function(e){
			if (e.which == 9){
				$('#navigation li:nth-child(' + (parseInt(current)+1) + ') a').click();
				/* force the blur for validation */
				$(this).blur();
				e.preventDefault();
			}
		});
	});
	
	/*
	validates errors on all the fieldsets
	records if the Form has errors in $('#formElem').data()
	*/
	function validateSteps(){
		var FormErrors = false;
		for(var i = 1; i < fieldsetCount; ++i){
			var error = validateStep(i);
			if(error == -1)
				FormErrors = true;
		}
		$('.edit_artist').data('errors',FormErrors);	
	}
	
	/*
	validates one fieldset
	and returns -1 if errors found, or 1 if not
	*/
	function validateStep(step){
		if(step == fieldsetCount) return;
		
		var error = 1;
		var hasError = false;
		$('.edit_artist').children(':nth-child('+ parseInt(step) +')').find(':input:not(button)').each(function(){
			var $this 		= $(this);
			var valueLength = jQuery.trim($this.val()).length;
			
			if(valueLength == ''){
				hasError = true;
				$this.css('background-color','#FFEDEF');
			}
			else
				$this.css('background-color','#FFFFFF');	
		});
		var $link = $('#navigation li:nth-child(' + parseInt(step) + ') a');
		$link.parent().find('.error,.checked').remove();
		
		var valclass = 'checked';
		if(hasError){
			error = -1;
			valclass = 'error';
		}
		$('<span class="'+valclass+'"></span>').insertAfter($link);
		
		return error;
	}
	
	/*
	if there are errors don't allow the user to submit
	*/
	$('.submit-button').bind('click',function(){
		if($('.edit_artist').data('errors')){
			alert('Please correct the errors in the Form');
			return false;
		}	
	});
});

</script>


